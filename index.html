<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kingshot Multi-Calculator</title>

<style>
:root {
  --primary-bg:#1e1e2f;
  --secondary-bg:#2a2a40;
  --text-color:#ffffff;
  --accent-color:#f5a623;
  --warn-color:#ff4c4c;
}

body {
  font-family: Arial, sans-serif;
  background: var(--primary-bg);
  padding: 20px;
  color: var(--text-color);
}

h1 {
  text-align:center;
  color:var(--accent-color);
}

h2, h3 {
  text-align:center;
  color:var(--accent-color);
  font-size:1.25rem;
  margin:24px 0 12px;
}

.container {
  max-width:800px;
  margin:auto;
  background:var(--secondary-bg);
  padding:20px;
  border-radius:8px;
}

/* ---------- Layout ---------- */
.row {
  display:flex;
  align-items:center;
  margin-bottom:10px;
}

label { flex:1; font-weight:bold; }
input, select, button {
  flex:2;
  padding:8px;
  margin-left:10px;
  border-radius:4px;
  border:none;
}

input, select {
  background:#444466;
  color:#fff;
}

button {
  cursor:pointer;
  font-weight:bold;
}

#addUpgrade { background:var(--accent-color); color:#1e1e2f; }
#resetBtn { background:var(--warn-color); color:#fff; margin-left:10px; }

/* ---------- HOW TO---------- */
details.howto {
  background:linear-gradient(180deg,#2b2f4a,#1f2238);
  border:1px dashed rgba(245,166,35,0.4);
  border-radius:8px;
  padding:10px 14px;
  margin-bottom:24px; /* prevents overlap */
  font-size:0.9rem;
}

details.howto summary {
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
  font-weight:bold;
  color:var(--accent-color);
  list-style:none;
}

details.howto summary::-webkit-details-marker {
  display:none;
}

/* Arrow is now REAL DOM text, not pseudo-element */
.summary-arrow {
  font-size:0.9rem;
}

details.howto[open] .summary-arrow {
  transform: rotate(90deg);
}

details.howto ul {
  margin:10px 0 0;
  padding-left:18px;
}

/* ---------- Upgrade Cards ---------- */
#upgradeLog {
  margin-top:16px;
}

.upgrade-card {
  position:relative;
  background:linear-gradient(180deg,#2b2f4a,#1f2238);
  border:1px solid var(--accent-color);
  border-radius:10px;
  padding:14px 18px 14px 44px;
  margin-bottom:14px;
}

.upgrade-card h4 {
  margin:0 0 6px;
  color:var(--accent-color);
}

.upgrade-section {
  margin-top:6px;
  padding-top:6px;
  border-top:1px dashed rgba(245,166,35,0.4);
}

.delete-btn {
  position:absolute;
  left:14px;
  top:14px;
  width:22px;
  height:22px;
  border-radius:50%;
  background:rgba(0,0,0,0.6);
  color:#ff6b6b;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:13px;
  line-height:1;
  cursor:pointer;
}

/* ---------- Remaining ---------- */
.value-normal { color:#fff; font-weight:bold; }
.value-negative { color:var(--warn-color); font-weight:bold; }
</style>
</head>

<body>

<h1>Kingshot Multi-Calculator</h1>

<div class="container">

<!-- HOW TO (NO OVERLAY POSSIBLE) -->
<details class="howto">
  <summary>
    <span>How to use it:</span>
    <span class="summary-arrow">▶</span>
  </summary>
  <ul>
    <li>Select a calculator type.</li>
    <li>Enter the materials you currently have.</li>
    <li>Select a tier/level and add upgrades.</li>
    <li>Remaining materials update automatically.</li>
    <li>Red numbers indicate insufficient materials.</li>
  </ul>
</details>

<h2>Select Calculator</h2>
<div class="row">
  <label>Calculator</label>
  <select id="calculatorSelect">
    <option value="gov">Governor Gear</option>
    <option value="charm">Charm</option>
    <option value="forgehammer">Forgehammer</option>
  </select>
</div>

<h3>Add Materials</h3>
<div class="row"><label id="matLabel1"></label><input type="number" id="currentMat1"></div>
<div class="row"><label id="matLabel2"></label><input type="number" id="currentMat2"></div>
<div class="row" id="matRow3"><label id="matLabel3"></label><input type="number" id="currentMat3"></div>

<h3>Select Tier / Level</h3>
<div class="row">
  <label>Tier</label>
  <select id="tierSelect"></select>
</div>

<button id="addUpgrade" onclick="addUpgrade()">Add Upgrade</button>
<button id="resetBtn" onclick="resetAll()">Reset</button>

<div id="upgradeLog"></div>

<h3>Remaining Materials</h3>
<div class="upgrade-card"><div id="remainingDisplay"></div></div>

</div>

<script>
const API_BASE="https://sheetdb.io/api/v1/uhbk5p3hj3hh8";
let tiersData=[], upgrades=[], remaining=null;
const normalize=s=>String(s).toLowerCase().replace(/\s+/g,'');

function getApiUrl(c){
  if(c==='gov') return `${API_BASE}?sheet=Gov Gear Material Cost`;
  if(c==='charm') return `${API_BASE}?sheet=Charm Upgrade Cost`;
  return `${API_BASE}?sheet=Forgehammer Cost`;
}

function updateMaterialLabels(c){
  if(c==='gov'){
    matLabel1.textContent='Satin';
    matLabel2.textContent='Threads';
    matLabel3.textContent='Artisans';
    matRow3.style.display='flex';
  } else if(c==='charm'){
    matLabel1.textContent='Guides';
    matLabel2.textContent='Designs';
    matRow3.style.display='none';
  } else {
    matLabel1.textContent='Hammer';
    matLabel2.textContent='Mythic Gear';
    matRow3.style.display='none';
  }
}

async function loadTierCosts(){
  const c=calculatorSelect.value;
  updateMaterialLabels(c);
  tierSelect.innerHTML='';
  const res=await fetch(getApiUrl(c));
  const data=await res.json();
  if(!data.length) return;

  const headers=Object.keys(data[0]);
  const tierKey=headers.find(h=>normalize(h).includes('tier')||normalize(h).includes('level'));
  const mats=headers.filter(h=>h!==tierKey).slice(0,c==='gov'?3:2);

  tiersData=data.map(r=>({
    tier:r[tierKey],
    mat1:+String(r[mats[0]]).replace(/,/g,'')||0,
    mat2:+String(r[mats[1]]).replace(/,/g,'')||0,
    mat3:c==='gov'?+String(r[mats[2]]).replace(/,/g,'')||0:0
  }));

  tiersData.forEach(t=>{
    const o=document.createElement('option');
    const i1=matLabel1.textContent.charAt(0);
    const i2=matLabel2.textContent.charAt(0);
    o.value=t.tier;
    o.textContent=c==='gov'
      ? `${t.tier} (${i1}:${t.mat1} ${i2}:${t.mat2} A:${t.mat3})`
      : `${t.tier} (${i1}:${t.mat1} ${i2}:${t.mat2})`;
    tierSelect.appendChild(o);
  });

  resetAll();
}

function recalcRemaining(){
  remaining={
    mat1:+currentMat1.value||0,
    mat2:+currentMat2.value||0,
    mat3:calculatorSelect.value==='gov'?+currentMat3.value||0:0
  };
  upgrades.forEach(u=>{
    remaining.mat1-=u.tier.mat1;
    remaining.mat2-=u.tier.mat2;
    if(calculatorSelect.value==='gov') remaining.mat3-=u.tier.mat3;
  });
}

const valSpan=v=>`<span class="${v<0?'value-negative':'value-normal'}">${v}</span>`;

function renderRemaining(){
  if(!remaining) return;
  remainingDisplay.innerHTML=
    calculatorSelect.value==='gov'
      ? `Satin: ${valSpan(remaining.mat1)} | Threads: ${valSpan(remaining.mat2)} | Artisans: ${valSpan(remaining.mat3)}`
      : `${matLabel1.textContent}: ${valSpan(remaining.mat1)} | ${matLabel2.textContent}: ${valSpan(remaining.mat2)}`;
}

function addUpgrade(){
  const t=tiersData.find(x=>x.tier===tierSelect.value);
  if(!t) return;
  const id=Date.now();
  upgrades.push({id,tier:t});
  recalcRemaining();
  renderRemaining();

  const c=document.createElement('div');
  c.className='upgrade-card';
  c.dataset.id=id;

  const d=document.createElement('span');
  d.className='delete-btn';
  d.textContent='⛔';
  d.onclick=()=>removeUpgrade(id);

  const h=document.createElement('h4');
  h.textContent=`Upgrade — ${t.tier}`;

  const s=document.createElement('div');
  s.className='upgrade-section';
  s.textContent =
  `${matLabel1.textContent}: ${t.mat1} | ${matLabel2.textContent}: ${t.mat2}` +
  (calculatorSelect.value === 'gov'
    ? ` | ${matLabel3.textContent}: ${t.mat3}`
    : '');
  
  c.append(d,h,s);
  upgradeLog.appendChild(c);
}

function removeUpgrade(id){
  upgrades=upgrades.filter(u=>u.id!==id);
  upgradeLog.querySelector(`[data-id="${id}"]`)?.remove();
  recalcRemaining();
  renderRemaining();
}

function resetAll(){
  upgrades=[];
  upgradeLog.innerHTML='';
  remaining=null;
  remainingDisplay.innerHTML='';
  currentMat1.value=currentMat2.value=currentMat3.value='';
}

['currentMat1','currentMat2','currentMat3'].forEach(id=>{
  document.getElementById(id)?.addEventListener('input',()=>{
    if(upgrades.length){
      recalcRemaining();
      renderRemaining();
    }
  });
});

calculatorSelect.addEventListener('change',loadTierCosts);
loadTierCosts();
</script>

</body>
</html>


